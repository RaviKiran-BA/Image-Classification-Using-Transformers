<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Image Classifier</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f0f0; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 400px; width: 100%; }
        h1 { text-align: center; }
        input { margin-bottom: 10px; width: 100%; }
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        img { max-width: 100%; height: auto; margin-bottom: 10px; }
        .error { color: red; text-align: center; }
        .result { margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rice Image Classifier</h1>
        <input type="file" id="imageInput" accept="image/*">
        <img id="preview" style="display: none;">
        <button onclick="predict()" id="predictBtn">Predict</button>
        <p id="error" class="error"></p>
        <div id="result" class="result"></div>
    </div>
    <script>
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const preview = document.getElementById('preview');
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
                document.getElementById('error').textContent = '';
                document.getElementById('result').innerHTML = '';
            }
        });

        async function predict() {
            const input = document.getElementById('imageInput');
            const button = document.getElementById('predictBtn');
            const error = document.getElementById('error');
            const result = document.getElementById('result');

            if (!input.files[0]) {
                error.textContent = 'Please select an image.';
                return;
            }

            button.disabled = true;
            button.textContent = 'Predicting...';
            error.textContent = '';

            const formData = new FormData();
            formData.append('file', input.files[0]);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                if (response.ok) {
                    result.innerHTML = `
                        <h3>Prediction Result:</h3>
                        <p><strong>Class:</strong> ${data.predicted_class}</p>
                        <p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(2)}%</p>
                        <h4>All Probabilities:</h4>
                        <ul>
                            ${Object.entries(data.all_probabilities).map(([cls, prob]) => 
                                `<li>${cls}: ${(prob * 100).toFixed(2)}%</li>`
                            ).join('')}
                        </ul>
                    `;
                } else {
                    error.textContent = data.error || 'Error making prediction.';
                }
            } catch (err) {
                error.textContent = 'Failed to connect to the server.';
            } finally {
                button.disabled = false;
                button.textContent = 'Predict';
            }
        }
    </script>
</body>
</html>